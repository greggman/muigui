<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>muigui</title>

    <meta name="description" content="muigui: A Small Simple JS GUI" />
    <meta name="keywords" content="javascript gui ui muigui" />
    <meta name="thumbnail" content="https://greggman.github.io/muigui/images/muigui.png" />

    <meta property="og:title" content="muigui" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://greggman.github.io/muigui/images/muigui.png" />
    <meta property="og:description" content="muigui: A Small Simple JS GUI" />
    <meta property="og:url" content="https://greggman.github.io/muigui/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@greggman">
    <meta name="twitter:creator" content="@greggman">
    <meta name="twitter:domain" content="greggman.github.io">
    <meta name="twitter:title" content="muigui">
    <meta name="twitter:url" content="https://greggman.github.io/muigui/">
    <meta name="twitter:description" content="muigui: A Small Simple JS GUI" />
    <meta name="twitter:image:src" content="https://greggman.github.io/muigui/images/muigui.png">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.0/showdown.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/javascript.min.js"></script>
    <link href="muigui.css" rel="stylesheet">
    <style>
      #ui {
        columns: 300px;
      }
      #ui>div {
        margin-bottom: 1em;
      }
    </style>
<body>
<h1>muigui</h1>
<h1 style="color: red;">Nothing to see here. NOT READY!</h1>
<div id="ui">

</div>
<pre id="result"></pre>
<hr>
</body>
<script type="module">
import {GUI} from './src/muigui.js';

const s = {
  speed: 0.5,
  direction: 45,
  friction: 0.01,
  run: true,
  animal: 'Bird',
  viscosity: 0.5,
  shoes: 1,
  show: () => { document.querySelector('#result').textContent = JSON.stringify(s, null, 2)},
  background: '#123456',
  name: 'gman',
};

const uiElem = document.querySelector('#ui');

for (let i = 0; i < 3; ++i) {
  const div = document.createElement('div');
  uiElem.appendChild(div);
  const gui = new GUI(div);
  gui.add(s, 'speed', 0, 100, 1); 
  gui.add(s, 'direction', 0, 360, 1).listen();
  gui.add(s, 'friction');
  gui.add(s, 'run');
  gui.add(s, 'animal', ['Cat', 'Bird', 'Dog']).listen();
  gui.add(s, 'viscosity', [['Slow', 0.1], ['Medium', 0.5], ['Fast', 1.0]]);
  gui.add(s, 'shoes', {"Loafers": 0, "Sandals": 1, "Sneakers": 2});
  gui.addColor(s, 'background').listen().onChange((v) => {
    document.body.style.backgroundColor = v;
  });
  gui.add(s, 'show').name('Show Current Values');
  const c = gui.addCanvas('sine wave');
  gui.add(s, 'name').listen();

  function resizeCanvasToDisplaySize(canvas) {
    const width = canvas.clientWidth;
    const height = canvas.clientHeight;
    const needResize = canvas.width !== width || canvas.height !== canvas.height;
    if (needResize) {
      canvas.width = width;
      canvas.height = height;
    }
    return needResize;
  }

  const ctx = c.canvas.getContext('2d');
  function draw(time) {
    resizeCanvasToDisplaySize(ctx.canvas);
    const {width, height} = ctx.canvas;
    ctx.drawImage(
        ctx.canvas,
        1, 0, width - 1, height,
        0, 0, width - 1, height);
    ctx.fillStyle = '#000';
    ctx.fillRect(width - 1, 0, 1, height);
    ctx.fillStyle = '#0F0';
    ctx.fillRect(width - 1, height / 2 + Math.sin(time * 0.01) * height / 2, 1, 1);
    requestAnimationFrame(draw);
  }
  requestAnimationFrame(draw);
}

{

  const div = document.createElement('div');
  uiElem.appendChild(div);

  const gui = new GUI().name('Appearance');

  function getCSSRuleBySelector(selector) {
    for (let s = 0; s < document.styleSheets.length; ++s) {
      const rules = document.styleSheets[s].cssRules;
      for (let i = 0; i < rules.length; ++i) {
        const r = rules[i];
        if (r.selectorText === selector) {
          return r;
        }
      }
    }
  }

  const temp = document.createElement('div');
  const cssStringToHexColor = s => s.length === 7
     ? s
     : `#${s[1]}${s[1]}${s[2]}${s[2]}${s[3]}${s[3]}`;

  const rule = getCSSRuleBySelector('.muigui');
  const varNames = Object.values(rule.style).filter(s => s.startsWith('--'));
  const obj = {};
  for (const key of varNames) {
    const value = rule.style.getPropertyValue(key).trim();
    if (value.startsWith('#')) {
      obj[key] = cssStringToHexColor(value);
      gui.addColor(obj, key).onChange(v => rule.style.setProperty(key, v));
    } else {
      obj[key] = value;
      gui.add(obj, key).onChange(v => rule.style.setProperty(key, v));
    }
  }
}
</script>
</html>