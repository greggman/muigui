<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>muigui</title>

    <meta name="description" content="muigui: A Small Simple JS GUI" />
    <meta name="keywords" content="javascript gui ui muigui" />
    <meta name="thumbnail" content="https://greggman.github.io/muigui/images/muigui.png" />

    <meta property="og:title" content="muigui" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://greggman.github.io/muigui/images/muigui.png" />
    <meta property="og:description" content="muigui: A Small Simple JS GUI" />
    <meta property="og:url" content="https://greggman.github.io/muigui/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@greggman">
    <meta name="twitter:creator" content="@greggman">
    <meta name="twitter:domain" content="greggman.github.io">
    <meta name="twitter:title" content="muigui">
    <meta name="twitter:url" content="https://greggman.github.io/muigui/">
    <meta name="twitter:description" content="muigui: A Small Simple JS GUI" />
    <meta name="twitter:image:src" content="https://greggman.github.io/muigui/images/muigui.png">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.0/showdown.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/javascript.min.js"></script>
    <link href="muigui.css" rel="stylesheet">
    <style>
      #ui-helper {
        display: grid;
        grid-template-columns: repeat(auto-fit, 250px); /* as as column width */
        gap: 10px; /* same as column gap */
      }
      #ui {
        columns: 250px;
        column-gap: 10px;
        grid-column: 1 / -1; /* take all the columns of the grid*/
      }
      #ui>div {
        break-inside: avoid-column;
        margin-bottom: 1em;
        display: inline-block;
      }      
    </style>
    <style id="media-query">
    </style>
<body>






<h1>muigui</h1>
<h1 style="color: red;">Nothing to see here. NOT READY!</h1>
<div id="ui-helper">
  <div id="ui"></div>
</div>
<pre id="result"></pre>
</body>
<script type="module">
import {GUI} from './src/muigui.js';

function getCSSRuleBySelector(selector) {
  for (let s = 0; s < document.styleSheets.length; ++s) {
    const rules = document.styleSheets[s].cssRules;
    for (let i = 0; i < rules.length; ++i) {
      const r = rules[i];
      if (r.selectorText === selector) {
        return r;
      }
    }
  }
}

const s = {
  speed: 0.5,
  direction: 45,
  friction: 0.01,
  run: true,
  animal: 'Bird',
  viscosity: 0.5,
  shoes: 1,
  show: () => { document.querySelector('#result').textContent = JSON.stringify(s, null, 2)},
  background: '#123456',
  name: 'gman',
  propertyWithLongName: 0,
};

const uiElem = document.querySelector('#ui');

for (let i = 0; i < 5; ++i) {
  const div = document.createElement('div');
  uiElem.appendChild(div);
  const gui = new GUI(div);
  gui.add(s, 'speed', 0, 100, 1); 
  gui.add(s, 'direction', 0, 360, 1).listen();
  gui.add(s, 'friction');
  gui.add(s, 'run');
  gui.add(s, 'animal', ['Cat', 'Bird', 'Dog']).listen();
  gui.add(s, 'viscosity', [['Slow', 0.1], ['Medium', 0.5], ['Fast', 1.0]]);
  gui.add(s, 'shoes', {"Loafers": 0, "Sandals": 1, "Sneakers": 2});
  gui.addColor(s, 'background').listen().onChange((v) => {
    document.body.style.backgroundColor = v;
  });
  gui.add(s, 'show').name('Show Current Values');

  const f = gui.addFolder('Submenu');
  const c = f.addCanvas('sine wave');
  f.add(s, 'name').listen();
  f.add(s, 'propertyWithLongName', ['longNamedEnumThatWillPushSizeTooFar']);

  function resizeCanvasToDisplaySize(canvas) {
    const width = canvas.clientWidth;
    const height = canvas.clientHeight;
    const needResize = canvas.width !== width || canvas.height !== canvas.height;
    if (needResize) {
      canvas.width = width;
      canvas.height = height;
    }
    return needResize;
  }

  const ctx = c.canvas.getContext('2d');
  function draw(time) {
    resizeCanvasToDisplaySize(ctx.canvas);
    const {width, height} = ctx.canvas;
    ctx.globalCompositeOperation = 'copy';
    ctx.drawImage(
        ctx.canvas,
        1, 0, width - 1, height,
        0, 0, width - 1, height);
    ctx.clearRect(width - 1, 0, 1, height);
    ctx.globalCompositeOperation = 'source-over';
    ctx.fillStyle = '#0F0';
    ctx.fillRect(width - 1, height / 2 + Math.sin(time * 0.01) * (height - 1) / 2, 1, 1);
    requestAnimationFrame(draw);
  }
  requestAnimationFrame(draw);
}

{

  const div = document.createElement('div');
  uiElem.appendChild(div);

  const gui = new GUI(div).name('Appearance');

  const temp = document.createElement('div');
  const cssStringToHexColor = s => s.length === 7
     ? s
     : `#${s[1]}${s[1]}${s[2]}${s[2]}${s[3]}${s[3]}`;

  const mediaQueryElem = document.createElement('style');
  document.head.appendChild(mediaQueryElem);
  const fixColumnMediaQueries = (width) => {
    width = parseInt(width); // should do other CSS?
    if (Number.isNaN(width) || width <= 0) {
      return;
    }
    const lines = [];
    for (let w = 0; w < 6000; w += width) {
//      lines.push(`@media (max-width: ${w + width * 2 - 1}px ) { #ui { width: ${w + width}px; }`);
      lines.push(`@media (max-width: ${w + width * 2 - 1}px ) { #ui { column-count: ${w / width + 1}; }`);
    }
    mediaQueryElem.textContent = lines.reverse().join('\n');
    //uiElem.style.columns = `${width}px`;
  };
  

  const fns = {
    '--width': (v) => {
      //fixColumnMediaQueries(v);
    }
  };

  const rule = getCSSRuleBySelector('.muigui');
  const varNames = Object.values(rule.style).filter(s => s.startsWith('--'));
  const obj = {};
  for (const key of varNames) {
    const value = rule.style.getPropertyValue(key).trim();
    if (value.startsWith('#')) {
      obj[key] = cssStringToHexColor(value);
      gui.addColor(obj, key).onChange(v => rule.style.setProperty(key, v));
    } else {
      obj[key] = value;
      const widget = gui.add(obj, key).onChange(v => rule.style.setProperty(key, v));
      const fn = fns[key];
      if (fn) {
        widget.onChange(fn);
        fn(value);
      }
    }
  }
}
</script>
</html>